{% extends "default.njk" %}

{% block seo %}
<title>{% if seo_title %}{{ seo_title }}{% else %}{{ title }}{% endif %}</title>

<link rel="canonical" href="{{ siteUrl }}/{{ slug }}/" />
<meta name="author" content="Jenish Jain" />
<meta name="description" content="{{ description }}" />
<meta name="keywords" content="{{ tags | join(', ') }}, engineering, tech blog, Jenish Jain{% if category == 'work-culture' %}, engineering at Rapido, Rapido{% endif %}" />
{% if image %}
<meta name="image" content="{{ image | cloudinary(page.inputPath, 1200) }}" />
{% else %}
<meta name="image" content="{{ title | seoImage }}" />
{% endif %}

<meta property="og:type" content="article" />
<meta property="og:url" content="{{ siteUrl }}/{{ slug }}/" />
<meta property="og:site_name" content="Jenish Jain's Engineering Blog" />
<meta property="og:description" content="{{ description }}" />
{% if image %}
<meta property="og:image" content="{{ image | cloudinary(page.inputPath, 1200) }}" />
{% else %}
<meta property="og:image" content="{{ title | seoImage }}" />
{% endif %}
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="article:published_time" content="{{ date | rssDate }}" />
<meta property="article:author" content="Jenish Jain" />
<meta property="article:section" content="{{ category }}" />
{% for tag in tags %}<meta property="article:tag" content="{{ tag }}" />
{% endfor %}

<meta name="twitter:dnt" content="on" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:creator" content="@jenishjain6" />
<meta name="twitter:title" content="{% if seo_title %}{{ seo_title }}{% else %}{{ title }}{% endif %}" />
<meta name="twitter:description" content="{{ description }}" />
{% if image %}
<meta name="twitter:image" content="{{ image | cloudinary(page.inputPath, 1200) }}" />
{% else %}
<meta name="twitter:image" content="{{ title | seoImage }}" />
{% endif %}
{% endblock %}

{% block main %}
<main>
  <nav aria-label="Breadcrumb" class="breadcrumb" style="
    grid-column: 1 / -1;
    margin-bottom: 0.5rem;
    font-size: 0.75rem;
    color: var(--color-text-muted);
  ">
    <ol style="
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    ">
      <li style="margin: 0;">
        <a href="/" style="color: var(--color-link); text-decoration: none;">Home</a>
      </li>
      <li aria-hidden="true" style="margin: 0;">&rsaquo;</li>
      <li style="margin: 0;">
        <a href="/posts/" style="color: var(--color-link); text-decoration: none;">Posts</a>
      </li>
      <li aria-hidden="true" style="margin: 0;">&rsaquo;</li>
      <li aria-current="page" style="margin: 0; color: var(--color-text-emphasized);">{{ title }}</li>
    </ol>
  </nav>

  <article class="post">
    {% block heading %}
    <div class="heading" style="margin-top: 0;">
      <h1>{{title}}</h1>
      <p class="lede">{{description}}</p>
    </div>
    {% endblock %}

    {% block details %}
    <div class="details">
      <figure class="author">
        <img
          src="https://res.cloudinary.com/jenishjain/image/upload/q_auto,f_auto,c_thumb,w_260,h_260,g_faces,z_0.55/v1700920184/portfolio/images/jenishjain-with-chopsticks.jpg"
          alt="Jenish Jain"
          width="260"
          height="260"
          style="object-fit: cover; aspect-ratio: 1 / 1;" />
        <figcaption>written by Jenish</figcaption>
      </figure>
      <div class="post-meta">
        <time datetime="{{ date | rssDate }}" style="
          display: block;
          font-size: 0.75rem;
          color: var(--color-text-muted);
          margin-top: 0.75rem;
          text-align: center;
        ">{{ date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) }}</time>
        <span style="
          display: block;
          font-size: 0.75rem;
          color: var(--color-text-muted);
          margin-top: 0.5rem;
          text-align: center;
        ">{{ content | readingTime }}</span>
      </div>
    </div>
    {% endblock %}

    {% block sidebar %}
    <div class="sidebar">
      <div class="sticky-sidebar">
        <div class="newsletter-nudge">
          <p>
            Hey, friends! I share posts like these regularly in my
            newsletter.
            <strong
              >Sign up to get my best stuff direct to your inbox.</strong
            >
          </p>
          <a href="/newsletter/" class="button">I love stuff!</a>
        </div>

        <details class="table-of-contents" open>
          <summary>Table of Contents</summary>

          {{ content | toc | safe }}
        </details>
      </div>
    </div>
    <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
      data-id="jenishjain" data-description="Support me on Buy me a pizza!" data-message="Buy me a pizza!"
      data-color="#5F7FFF" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
    {% endblock %}

    {% block content %}
    <div class="content">
      {{ content | safe }}
    </div>
    {% endblock %}
  </article>

  {# Related Posts Section - Below entire article #}
  {% set relatedPostsList = collections.posts | relatedPosts(slug, tags, 3) %}
  {% if relatedPostsList.length > 0 %}
  <aside class="related-posts" style="
    margin: 3rem auto 2rem;
    padding: 2.5rem 0 0;
    border-top: 3px solid var(--color-yellow-500);
    max-width: 100%;
  ">
    <h2 style="
      font-size: 1.75rem;
      margin-bottom: 2rem;
      text-align: center;
      color: var(--color-text-heading);
    ">Continue Reading</h2>

    <div style="
      display: grid;
      gap: 1.5rem;
      grid-template-columns: repeat(auto-fit, minmax(250px, 280px));
      justify-content: center;
    ">
      {% for post in relatedPostsList %}
      <article class="related-post-card" style="
        background: var(--color-background);
        border: 1px solid var(--color-border);
        border-radius: 0.25rem;
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
      " onmouseover="this.style.borderColor='var(--color-yellow-500)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)';" onmouseout="this.style.borderColor='var(--color-border)'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">

        {% if post.data.thumb %}
        <img src="{{ post.data.thumb }}" alt="{{ post.data.title }}" loading="lazy" style="
          width: 100%;
          height: 140px;
          object-fit: cover;
          display: block;
          margin: 0;
        " />
        {% endif %}

        <div style="padding: 1.25rem; display: flex; flex-direction: column; flex: 1;">
          <h3 style="
            font-size: 0.875rem;
            margin: 0 0 0.625rem 0;
            line-height: 1.3;
            font-weight: 600;
            color: var(--color-text-heading);
            padding: 0;
          ">
            <a href="{% if post.data.url %}{{ post.data.url }}{% else %}/{{ post.data.slug }}/{% endif %}"{% if post.data.url %} target="_blank" rel="noopener noreferrer"{% endif %} style="
              text-decoration: none;
              color: inherit;
            " onmouseover="this.style.color='var(--color-link)';" onmouseout="this.style.color='var(--color-text-heading)';">
              {{ post.data.title }}
            </a>
          </h3>

          <p style="
            margin: 0 0 auto;
            color: var(--color-text-default);
            font-size: 0.75rem;
            line-height: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
          ">
            {{ post.data.description }}
          </p>

          <span aria-hidden="true" style="
            display: block;
            color: var(--color-primary);
            font-size: 0.5rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin-top: 0.75rem;
          ">read this post &rarr;</span>
        </div>
      </article>
      {% endfor %}
    </div>
  </aside>
  {% endif %}
</main>
{% endblock %}

{% block scripts %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ title }}",
  "description": "{{ description }}",
  "author": {
    "@type": "Person",
    "name": "Jenish Jain",
    "url": "https://jenishjain.in",
    "sameAs": [
      "https://twitter.com/jenishjain6",
      "https://github.com/jenish-jain",
      "https://www.linkedin.com/in/jenish-jain"
    ]
  },
  "datePublished": "{{ date | rssDate }}",
  "dateModified": "{{ date | rssDate }}",
  {% if image %}
  "image": "{{ image | cloudinary(page.inputPath, 1200) }}",
  {% else %}
  "image": "{{ title | seoImage }}",
  {% endif %}
  "publisher": {
    "@type": "Person",
    "name": "Jenish Jain",
    "logo": {
      "@type": "ImageObject",
      "url": "https://res.cloudinary.com/jenishjain/image/upload/q_auto,f_auto,c_thumb,w_260,h_260,g_faces,z_0.55/v1700920184/portfolio/images/jenishjain-with-chopsticks.jpg"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ siteUrl }}/{{ slug }}/"
  },
  "keywords": "{{ tags | join(', ') }}, engineering, tech blog, Jenish Jain",
  "articleSection": "{{ category }}"
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https://jenishjain.in"
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "{{ siteUrl }}/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Posts",
      "item": "{{ siteUrl }}/posts/"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "{{ title }}",
      "item": "{{ siteUrl }}/{{ slug }}/"
    }
  ]
}
</script>

<script src="/scripts/post.min.js"></script>
{% endblock %}
